<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      margin: 40px;
      background: #f4f4f4;
      color: #333;
      transition: all 0.3s ease;
    }
    h1, h2 {
      color: #2c3e50;
      transition: color 0.3s ease;
    }
    .section {
      background: #fff;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 30px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      opacity: 0;
      transform: translateX(-50px);
      transition: all 0.6s ease-in-out;
    }
    .section.visible {
      opacity: 1;
      transform: translateX(0);
    }
    code, pre {
      background: #ecf0f1;
      padding: 4px 8px;
      border-radius: 6px;
      display: block;
      white-space: pre-wrap;
      margin-top: 10px;
    }
    .tooltip {
      position: relative;
      cursor: help;
      border-bottom: 1px dashed #555;
    }
    .tooltip:hover::after {
      content: attr(title);
      position: absolute;
      left: 0;
      top: 120%;
      background: #222;
      color: #fff;
      padding: 6px 8px;
      border-radius: 6px;
      white-space: nowrap;
      font-size: 13px;
      z-index: 10;
    }
    
    .dark-mode {
      background: #1e1e1e;
      color: #f4f4f4;
    }
    .dark-mode h1, 
    .dark-mode h2 {
      color: #64b5f6;
    }
    .dark-mode .section {
      background: #2c2c2c;
      box-shadow: 0 4px 12px rgba(255, 255, 255, 0.05);
    }
    .dark-mode code, 
    .dark-mode pre {
      background: #333;
      color: #ddd;
    }
    
    .theme-toggle {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 10px 20px;
      border: none;
      background: #2c3e50;
      color: white;
      border-radius: 6px;
      cursor: pointer;
      z-index: 1000;
      transition: background 0.3s ease;
    }
    .theme-toggle:hover {
      background: #34495e;
    }
    
    /* –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ */
    .progress-indicator {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: rgba(44, 62, 80, 0.9);
      color: white;
      padding: 10px 15px;
      border-radius: 20px;
      font-size: 14px;
      z-index: 1000;
    }
    .dark-mode .progress-indicator {
      background: rgba(100, 181, 246, 0.9);
      color: #1e1e1e;
    }
    
    @media (max-width: 768px) {
      body {
        margin: 20px;
      }
      .theme-toggle {
        top: 10px;
        right: 10px;
        padding: 8px 16px;
        font-size: 14px;
      }
      .progress-indicator {
        bottom: 10px;
        right: 10px;
        padding: 8px 12px;
        font-size: 12px;
      }
    }
  </style>
</head>
<body>
  <button class="theme-toggle" onclick="toggleTheme()">üåì –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É</button>
  <div class="progress-indicator" id="progressIndicator">–ë–ª–æ–∫ 1 –∏–∑ 8</div>

  <h1>–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è API</h1>

  <div class="section">
    <h2>üîß –Ø–¥—Ä–æ: JUnit 5</h2>
    <p>JUnit 5 —è–≤–ª—è–µ—Ç—Å—è –æ—Å–Ω–æ–≤–æ–π –≤—Å–µ–π —Ç–µ—Å—Ç–æ–≤–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã. –û–Ω –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤, –∞–Ω–Ω–æ—Ç–∞—Ü–∏–∏ <code>@Test</code><code>@BeforeAll</code><code>@DisplayName</code> –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ —Å–≤—è–∑–∫–µ —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è–º–∏, —Ç–∞–∫–∏–º–∏ –∫–∞–∫ <code>@ExtendWith</code> –¥–ª—è –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π<code>@Tag</code> –¥–ª—è –º–∞—Ä–∫–∏—Ä–æ–≤–∫–∏ —Ç–µ—Å—Ç–æ–≤ <code>@DisableGradleRetry</code> –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–≤—Ç–æ—Ä–Ω—ã–º –∑–∞–ø—É—Å–∫–æ–º.</p>
    <details>
      <summary><strong>–ü—Ä–∏–º–µ—Ä—ã —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–π</strong></summary>
      <pre><code>@ExtendWith(InjectFieldsExtension.class) // –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
@Tag("Smoke")                        // –º–∞—Ä–∫–∏—Ä–æ–≤–∫–∞ smoke-—Ç–µ—Å—Ç–æ–≤
@DisableGradleRetry                  // –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø—Ä–æ–≥–æ–Ω–æ–≤ –≤ CI</code></pre>
    </details>
  </div>

  <div class="section">
    <h2>üìà Allure</h2>
    <p>–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —á–∏—Ç–∞–µ–º—ã—Ö –æ—Ç—á—ë—Ç–æ–≤. –ê–Ω–Ω–æ—Ç–∞—Ü–∏–∏ <code>@Step</code> –∏ <code>@TmsLink</code> –ø–æ–∑–≤–æ–ª—è—é—Ç –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —à–∞–≥–∏ —Ç–µ—Å—Ç–æ–≤ –∏ —É–≤—è–∑—ã–≤–∞—Ç—å –∏—Ö —Å TMS.</p>
  </div>

  <div class="section">
    <h2>üß™ AssertJ</h2>
    <p>–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ fluent-assertions. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –º—è–≥–∫–∏—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ —á–µ—Ä–µ–∑ <code>SoftAssertions</code>–ø–æ–∑–≤–æ–ª—è—è –Ω–∞–∫–∞–ø–ª–∏–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –æ—à–∏–±–æ–∫ –≤ –æ–¥–Ω–æ–º —Ç–µ—Å—Ç–µ –∏ –≤—ã–±—Ä–∞—Å—ã–≤–∞—Ç—å –∏—Ö –≤—Å–µ —Å—Ä–∞–∑—É –ø—Ä–∏ –≤—ã–∑–æ–≤–µ<code>assertAll()</code></p>
    <details>
      <summary><strong>–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</strong></summary>
      <pre><code>SoftAssertions softly = new SoftAssertions();
softly.assertThat(actualValue).isEqualTo(expectedValue);
softly.assertThat(list).hasSizeGreaterThan(2);
softly.assertAll();</code></pre>
      <p>–ü–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ –∏ —Å–æ–±—Ä–∞—Ç—å –≤—Å–µ –æ—à–∏–±–∫–∏ –≤ –∫–æ–Ω—Ü–µ.</p>
    </details>
  </div>

  <div class="section">
    <h2>üåê RestAssured</h2>
    <p>–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è API-–∑–∞–ø—Ä–æ—Å–æ–≤ –∫ backend —Å–µ—Ä–≤–∏—Å–∞–º, –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ <code>RestHelper</code>–ë–∞–∑–æ–≤—ã–µ URI –ø–æ–¥—Ç—è–≥–∏–≤–∞—é—Ç—Å—è –∏–∑ <code>config.yml</code></p>
  </div>

  <div class="section">
    <h2>üìÅ Apache POI</h2>
    <p>–î–ª—è —á—Ç–µ–Ω–∏—è –∏ –∑–∞–ø–∏—Å–∏ Excel-—Ñ–∞–π–ª–æ–≤, –æ—Å–æ–±–µ–Ω–Ω–æ –ø—Ä–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –º–∞–∫—Ä–æ/–¢–°/–ø—Ä–æ–¥—É–∫—Ç–æ–≤—ã—Ö —á–µ—Ä–Ω–æ–≤–∏–∫–æ–≤ –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ä–∞—Å—á—ë—Ç–∞.</p>
  </div>

  <div class="section">
    <h2>üß© –ö–∞—Å—Ç–æ–º–Ω—ã–µ –Ω–∞–¥—Å—Ç—Ä–æ–π–∫–∏ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞</h2>
    <p>–í –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫ –±–∏–±–ª–∏–æ—Ç–µ–∫–∞–º, –≤–æ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –º–æ—â–Ω—ã–µ –Ω–∞–¥—Å—Ç—Ä–æ–π–∫–∏, —Ä–∞—Å—à–∏—Ä—è—é—â–∏–µ –µ–≥–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å:</p>

    <h3>üì¶ MigrationBuilder</h3>
    <p>DSL-–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–≤ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∏ —Ä–∞—Å—á—ë—Ç–æ–≤, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –ø–µ—Ä–µ–¥ —Ç–µ—Å—Ç–æ–º:</p>
    <details>
      <summary><strong>–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</strong></summary>
      <pre><code>new MigrationBuilder()
    .build("first")
    .withUploadIndicatorsMapping(...)
    .withUploadProductScenarioStructure(...)
    .withCreateCalculation(...)
    .and()
    .execute();</code></pre>
      <p>–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ <code>SmokeTest</code> –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–æ–≤ –∏ —Ä–∞—Å—á—ë—Ç–æ–≤.</p>
    </details>

    <h3>üßÆ CsvUtils –∏ ExcelFileComparator</h3>
    <p>–£—Ç–∏–ª–∏—Ç—ã –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤—ã–≥—Ä—É–∑–æ–∫ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ä–∞—Å—á—ë—Ç–∞:</p>
    <details>
      <summary><strong>–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</strong></summary>
      <pre><code>CsvUtils.validateCsvHeaders(content, TestHeadersVersionResults.EXPECTED_HEADERS);
ExcelFileComparator.compareSheets(sheetBeforeFixation, sheetAfterRestore);</code></pre>
      <p>–ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã CSV –∏ Excel-—Ñ–∞–π–ª–æ–≤.</p>
    </details>

    <h3>üåê RestHelper</h3>
    <p>–£–ø—Ä–æ—â–∞–µ—Ç —Ä–∞–±–æ—Ç—É —Å RestAssured —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∏—Ä—É–µ–º—ã–µ —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏:</p>
    <details>
      <summary><strong>–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</strong></summary>
      <pre><code>given(RestHelper.REQUEST_CORE_SPEC)
    .param("calculationUid", calculationUid)
    .get(CalculationDraftEndpoint.PARAMETERS);</code></pre>
      <p>–£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –≤—ã–∑–æ–≤ API —Å –ª–æ–≥–∞–º–∏ –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–µ–π.</p>
    </details>

    <h3>üîÅ Retry</h3>
    <p>–ö–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –∑–∞–ø—É—Å–∫–∞–º–∏ —Ç–µ—Å—Ç–æ–≤ —á–µ—Ä–µ–∑ –∞–Ω–Ω–æ—Ç–∞—Ü–∏—é <code>@DisableGradleRetry</code></p>
    <details>
      <summary><strong>–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è</strong></summary>
      <pre><code>@DisableGradleRetry
public class SmokeTest { ... }</code></pre>
      <p>–ü—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –º–µ—Ç–æ–¥–∞ –≤ –∫–ª–∞—Å—Å–µ –æ–Ω –Ω–µ –±—É–¥–µ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω n-—Ä–∞–∑</p>
    </details>

    <h3>üì¶ Shared DTO –≤–º–µ—Å—Ç–æ Swagger</h3>
    <p>–í—Å–µ –º–æ–¥–µ–ª–∏ –¥–ª—è API-—Ç–µ—Å—Ç–æ–≤ –±–µ—Ä—É—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é –∏–∑ shared-–º–æ–¥—É–ª–µ–π, –∞ –Ω–µ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –∏–∑ OpenAPI:</p>
    <ul>
      <li>–ì–∞—Ä–∞–Ω—Ç–∏—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å backend</li>
      <li>–°—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –∏ –ø—Ä–æ—Å—Ç–æ—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π</li>
    </ul>
  </div>

  <div class="section">
    <h2>üöÄ –ü–æ–¥—Ä–æ–±–Ω—ã–π —Ä–∞–∑–±–æ—Ä: SmokeTest</h2>
    <p>–ù–∏–∂–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω –ø–æ–ª–Ω—ã–π –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ SmokeTest —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º–∏ –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è–º–∏ –Ω–∞ –∫–∞–∂–¥—ã–π –ª–æ–≥–∏—á–µ—Å–∫–∏–π –±–ª–æ–∫.</p>
    <pre><code>// –ê–Ω–Ω–æ—Ç–∞—Ü–∏–∏ JUnit –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –¥–ª—è Allure –∏ DI
@Slf4j
@DisableGradleRetry
@ExtendWith(InjectFieldsExtension.class)
public class SmokeTest {

    // –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã —Å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
    private static final UUID FILE_TYPE_UID = UUID.fromString("98a7d4b7-a313-47de-956d-dbba52bc6d7c");
    private static final String PRODUCT_SCENARIO_FILE = "product_file_upload_smoke.xlsx";
    private static final String INDICATORS_MAPPING_FILE = "indicators_mapping_upload_code40.xlsx";
    private static final String INDICATORS_CODE = "code40";
    private static final UUID TYPE_INDICATORS_MAPPING_UID = UUID.fromString("2145c9af-caec-45f4-bd9b-bceaf23645e1");
    private static final LocalDate FACT_DATE_FIRST = LocalDate.of(2024, 2, 29);
    private static final LocalDate END_DATE_FIRST = LocalDate.of(2024, 3, 7);

    @Inject(process = "first", name = "calculationUid")
    private UUID calculationUidFirst;

    @BeforeAll
    public static void init() {
        initializeTestEnvironment();
    }

    @Step("–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–µ—Å—Ç–æ–≤–æ–π —Å—Ä–µ–¥—ã")
    private static void initializeTestEnvironment() {
        ProductTreeUtils.generateProductTreeWithTimestamps(PRODUCT_SCENARIO_FILE, 1);
        ProductStructureExcelReader reader = new ProductStructureExcelReader(PRODUCT_SCENARIO_FILE);
        String code = reader.getProductTreeCodeFromExcel();
        List<String> products = reader.getProductCodes("third");
        // buildAndExecuteMigration(...) –¥–ª—è 3 —Ä–∞—Å—á—ë—Ç–æ–≤
    }

    @Tag("Smoke")
    @Test
    @DisplayName("Main")
    public void smokeTestsScenario() {
        SoftAssertions softly = new SoftAssertions();
        executeStep(softly, this::validateDownloadProductStructure, "–°–∫–∞—á–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã");
        executeStep(softly, this::validateArchiveProductStructure, "–ê—Ä—Ö–∏–≤–∞—Ü–∏—è –ø—Ä–æ–¥—É–∫—Ç–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã");
        executeStep(softly, this::validateDownloadIndicatorsMapping, "–°–∫–∞—á–∏–≤–∞–Ω–∏–µ –º—ç–ø–ø–∏–Ω–≥–∞ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–æ–≤");
        executeStep(softly, this::validateArchiveIndicatorsMapping, "–ê—Ä—Ö–∏–≤–∞—Ü–∏—è –º—ç–ø–ø–∏–Ω–≥–∞");
        executeStep(softly, this::validateMacroDraft, "–ü—Ä–æ–≤–µ—Ä–∫–∞ –º–∞–∫—Ä–æ —á–µ—Ä–Ω–æ–≤–∏–∫–∞");
        executeStep(softly, this::validateTRDraft, "–ü—Ä–æ–≤–µ—Ä–∫–∞ –¢–° —á–µ—Ä–Ω–æ–≤–∏–∫–∞");
        executeStep(softly, this::validateProductDraft, "–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤–æ–≥–æ –¥—Ä–∞—Ñ—Ç–∞");
        executeStep(softly, this::validateNsi, "–ü—Ä–æ–≤–µ—Ä–∫–∞ NSI —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞");
        executeStep(softly, this::validateCreateVersion, "–°–æ–∑–¥–∞–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ —Ä–∞—Å—á—ë—Ç–∞");
        executeStep(softly, this::validateDownloadResultVersion, "–°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ —Ä–∞—Å—á—ë—Ç–∞");
        executeStep(softly, this::validateJsonParamForVersion, "–ü—Ä–æ–≤–µ—Ä–∫–∞ JSON –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ä–∞—Å—á—ë—Ç–∞");
        executeStep(softly, this::validateDownloadParamsVersion, "–°–∫–∞—á–∏–≤–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤ –≤–µ—Ä—Å–∏–∏");
        softly.assertAll();
    }

    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç–æ–¥—ã SmokeTest

    @Step("–°–∫–∞—á–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã")
    private void validateDownloadProductStructure() {
        byte[] content = ProductTreeServiceNew.download(sliceUid);
        try (Workbook workbook = new XSSFWorkbook(new ByteArrayInputStream(content))) {
            Sheet sheet = workbook.getSheetAt(0);
            Row headerRow = sheet.getRow(0);
            checkRequiredHeaders(headerRow, TestHeadersProductStructureResults.EXPECTED_HEADERS);
        } catch (IOException e) {
            throw new RuntimeException("–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ Excel-—Ñ–∞–π–ª–∞: " + e.getMessage(), e);
        }
    }

    @Step("–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∞ NSI")
    private void validateNsi() {
        UUID upload = uploadFile("discount_factors_2025-A1.xlsx", "Discount factors for NPV");
        verifyEtlState(upload, "ETL_COMPLETED");
    }

    @Step("–ü—Ä–æ–≤–µ—Ä–∫–∞ JSON –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤–µ—Ä—Å–∏–∏")
    private void validateJsonParamForVersion() {
        SoftAssertions softly = new SoftAssertions();
        ObjectMapper objectMapper = new ObjectMapper();
        try {
            validateJsonStructure("START_CASHFLOW_CALCULATION",
                CalculationVersionServiceNew.downloadCalcParam(calculationThirdVersionUid, "START_CASHFLOW_CALCULATION"),
                softly);
            validateJsonStructure("UPLOAD_CASHFLOW_CALCULATION_PARAMETERS",
                CalculationVersionServiceNew.downloadCalcParam(calculationThirdVersionUid, "UPLOAD_CASHFLOW_CALCULATION_PARAMETERS"),
                softly);
        } catch (IOException e) {
            softly.fail("–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞–∑–±–æ—Ä–µ JSON: " + e.getMessage());
        }
        softly.assertAll();
    }

    private void executeStep(SoftAssertions softly, Runnable step, String stepName) {
        log.info("–í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —à–∞–≥: {}", stepName);
        try {
            step.run();
            log.info("–®–∞–≥ —É—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω: {}", stepName);
        } catch (Throwable t) {
            log.error("–û—à–∏–±–∫–∞ –≤ —à–∞–≥–µ '{}': {}", stepName, t.getMessage(), t);
            softly.fail("–®–∞–≥ '" + stepName + "' —É–ø–∞–ª: " + t.getMessage(), t);
        }
    }
}</code></pre>
    <p>–¢–µ—Å—Ç –ø–æ–∫—Ä—ã–≤–∞–µ—Ç –≤–µ—Å—å –∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª —Ä–∞—Å—á—ë—Ç–∞: –∑–∞–≥—Ä—É–∑–∫—É, –≤–∞–ª–∏–¥–∞—Ü–∏–∏, —Ñ–∏–∫—Å–∞—Ü–∏—é –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–Ω–æ–≤–∏–∫–æ–≤, –∑–∞–ø—É—Å–∫ –≤–µ—Ä—Å–∏–∏ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—é —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ Excel –∏ JSON.</p>
  </div>

  <script>
    function toggleTheme() {
      document.body.classList.toggle('dark-mode');
    }

    document.addEventListener("DOMContentLoaded", function () {
      const sections = document.querySelectorAll(".section");
      const progressIndicator = document.getElementById("progressIndicator");
      const DELAY_BEFORE_ACTIVATION = 3000;

      let interactionEnabled = false;
      let currentVisibleIndex = 0;

      setTimeout(() => {
        interactionEnabled = true;
      }, DELAY_BEFORE_ACTIVATION);

      if (sections.length > 0) {
        sections[0].classList.add("visible");
        updateProgress();
      }

      function updateProgress() {
        progressIndicator.textContent = `–ë–ª–æ–∫ ${currentVisibleIndex + 1} –∏–∑ ${sections.length}`;
      }

      function showNextSection() {
        if (currentVisibleIndex < sections.length - 1) {
          currentVisibleIndex++;
          sections[currentVisibleIndex].classList.add("visible");
          updateProgress();
        }
      }

      sections.forEach((section, index) => {
        section.addEventListener("mousemove", (e) => {
          if (!interactionEnabled || index !== currentVisibleIndex) return;

          const rect = section.getBoundingClientRect();
          const offsetY = e.clientY - rect.top;

          if (offsetY >= rect.height - 5) {
            showNextSection();
          }
        });
      });

      let touchStartY = 0;
      let hasScrolledInSection = false;

      sections.forEach((section, index) => {
        section.addEventListener("touchstart", (e) => {
          if (!interactionEnabled || index !== currentVisibleIndex) return;
          touchStartY = e.touches[0].clientY;
          hasScrolledInSection = false;
        });

        section.addEventListener("touchmove", (e) => {
          if (!interactionEnabled || index !== currentVisibleIndex) return;
          
          const touchCurrentY = e.touches[0].clientY;
          const scrollDirection = touchStartY - touchCurrentY;
          
          if (scrollDirection > 50 && !hasScrolledInSection) { // –°–≤–∞–π–ø –≤–≤–µ—Ä—Ö
            hasScrolledInSection = true;
            showNextSection();
          }
        });

        section.addEventListener("click", () => {
          if (!interactionEnabled) return;
          if (index === currentVisibleIndex) {
            showNextSection();
          }
        });
      });

      window.addEventListener("scroll", () => {
        if (!interactionEnabled) return;
        
        const currentSection = sections[currentVisibleIndex];
        if (!currentSection) return;
        
        const rect = currentSection.getBoundingClientRect();
        const windowHeight = window.innerHeight;
        
        if (rect.bottom < windowHeight * 0.3) {
          showNextSection();
        }
      });

      const observer = new MutationObserver(() => {
        if (currentVisibleIndex === sections.length - 1) {
          setTimeout(() => {
            progressIndicator.style.opacity = '0.5';
          }, 2000);
        }
      });

      sections.forEach(section => {
        observer.observe(section, { attributes: true, attributeFilter: ['class'] });
      });
    });
  </script>
</body>
</html>